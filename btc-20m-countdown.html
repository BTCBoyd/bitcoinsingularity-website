<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>20 Million Bitcoin Countdown - BitcoinSingularity.AI</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        :root {
            --bitcoin-orange: #F7931A;
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-tertiary: #1a1a25;
            --text-primary: #e8e8ed;
            --text-secondary: #8888a0;
            --success-green: #10B981;
            --error-red: #EF4444;
            --border-subtle: rgba(136, 136, 160, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
        }

        header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-subtle);
            padding: 1rem 0;
        }

        nav {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            color: var(--text-primary);
            text-decoration: none;
            font-weight: 700;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            list-style: none;
        }

        .nav-links a {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.95rem;
            transition: color 0.2s;
        }

        .nav-links a:hover {
            color: var(--text-primary);
        }

        .countdown-hero {
            text-align: center;
            padding: 4rem 2rem;
            background: var(--bg-primary);
        }

        .countdown-title {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: var(--bitcoin-orange);
        }

        .countdown-subtitle {
            font-size: 1.2rem;
            color: var(--text-secondary);
            margin-bottom: 3rem;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            max-width: 1200px;
            margin: 0 auto 3rem;
        }

        .stat-card {
            background: var(--bg-tertiary);
            padding: 2rem;
            border-radius: 1rem;
            border: 1px solid var(--border-subtle);
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 0.5rem;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--text-primary);
            font-family: 'IBM Plex Mono', monospace;
        }

        .stat-subvalue {
            font-size: 1rem;
            color: var(--text-secondary);
            margin-top: 0.5rem;
        }

        .progress-bar {
            width: 100%;
            height: 40px;
            background: var(--bg-tertiary);
            border-radius: 20px;
            overflow: hidden;
            margin: 2rem 0;
            position: relative;
            border: 1px solid var(--border-subtle);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--bitcoin-orange) 0%, #f7a91a 100%);
            transition: width 1s ease-in-out;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 1rem;
            font-weight: 700;
            color: var(--bg-primary);
        }

        .countdown-timer {
            display: flex;
            justify-content: center;
            gap: 2rem;
            flex-wrap: wrap;
            margin: 3rem 0;
        }

        .time-unit {
            text-align: center;
        }

        .time-value {
            font-size: 3rem;
            font-weight: 700;
            color: var(--bitcoin-orange);
            font-family: 'IBM Plex Mono', monospace;
        }

        .time-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-top: 0.5rem;
        }

        .party-info {
            background: var(--bg-secondary);
            padding: 2rem;
            border-radius: 1rem;
            border: 1px solid var(--bitcoin-orange);
            margin: 3rem auto;
            max-width: 800px;
        }

        .party-info h3 {
            color: var(--bitcoin-orange);
            margin-bottom: 1rem;
        }

        .map-section {
            max-width: 1200px;
            margin: 4rem auto;
            padding: 0 2rem;
        }

        .map-section h2 {
            text-align: center;
            color: var(--bitcoin-orange);
            margin-bottom: 2rem;
            font-size: 2rem;
        }

        #party-map {
            height: 500px;
            border-radius: 1rem;
            border: 1px solid var(--border-subtle);
            margin-bottom: 2rem;
        }

        .add-party-form {
            background: var(--bg-secondary);
            padding: 2rem;
            border-radius: 1rem;
            border: 1px solid var(--border-subtle);
            max-width: 600px;
            margin: 0 auto;
        }

        .add-party-form h3 {
            color: var(--text-primary);
            margin-bottom: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-subtle);
            border-radius: 0.5rem;
            color: var(--text-primary);
            font-size: 1rem;
            font-family: inherit;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--bitcoin-orange);
        }

        .submit-btn {
            width: 100%;
            padding: 1rem;
            background: var(--bitcoin-orange);
            color: var(--bg-primary);
            border: none;
            border-radius: 0.5rem;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: opacity 0.2s;
        }

        .submit-btn:hover {
            opacity: 0.9;
        }

        .submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .form-note {
            margin-top: 1rem;
            font-size: 0.85rem;
            color: var(--text-secondary);
            text-align: center;
        }

        .parties-list {
            max-width: 800px;
            margin: 2rem auto;
        }

        .party-card {
            background: var(--bg-secondary);
            padding: 1.5rem;
            border-radius: 0.5rem;
            border: 1px solid var(--border-subtle);
            margin-bottom: 1rem;
        }

        .party-card h4 {
            color: var(--bitcoin-orange);
            margin-bottom: 0.5rem;
        }

        .party-card p {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin: 0.25rem 0;
        }

        .loading {
            color: var(--text-secondary);
            font-style: italic;
        }

        @media (max-width: 768px) {
            .countdown-title {
                font-size: 1.8rem;
            }
            
            .time-value {
                font-size: 2rem;
            }
            
            .stat-value {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <nav>
            <a href="/" class="logo">
                <span style="font-size: 1.2rem;">‚Çø</span> Bitcoin Singularity
            </a>
            <ul class="nav-links">
                <li><a href="/research">Research</a></li>
                <li><a href="/evidence">Evidence Tracker</a></li>
                <li><a href="/tools">Tools</a></li>
                <li><a href="/knowledge">Knowledge Base</a></li>
                <li><a href="/chat">Ask Maxi</a></li>
                <li><a href="/about">About</a></li>
            </ul>
        </nav>
    </header>

    <div class="countdown-hero">
        <h1 class="countdown-title">üéâ 20 MILLION BITCOIN COUNTDOWN</h1>
        <p class="countdown-subtitle">Historic milestone approaching - join us in Monterrey to celebrate</p>

        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-label">Bitcoin Mined</div>
                <div class="stat-value" id="btc-mined"><span class="loading">Loading...</span></div>
                <div class="stat-subvalue">out of 21,000,000 maximum</div>
            </div>

            <div class="stat-card">
                <div class="stat-label">Remaining Until 20M</div>
                <div class="stat-value" id="btc-remaining"><span class="loading">Loading...</span></div>
                <div class="stat-subvalue" id="blocks-remaining">Loading blocks...</div>
            </div>

            <div class="stat-card">
                <div class="stat-label">Estimated Date</div>
                <div class="stat-value" id="target-date" style="font-size: 1.5rem;"><span class="loading">Calculating...</span></div>
                <div class="stat-subvalue" id="target-time">Loading...</div>
            </div>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progress-bar">
                <span id="progress-percent">0%</span>
            </div>
        </div>

        <div class="countdown-timer">
            <div class="time-unit">
                <div class="time-value" id="days">--</div>
                <div class="time-label">Days</div>
            </div>
            <div class="time-unit">
                <div class="time-value" id="hours">--</div>
                <div class="time-label">Hours</div>
            </div>
            <div class="time-unit">
                <div class="time-value" id="minutes">--</div>
                <div class="time-label">Minutes</div>
            </div>
            <div class="time-unit">
                <div class="time-value" id="seconds">--</div>
                <div class="time-label">Seconds</div>
            </div>
        </div>

        <div class="party-info">
            <h3>üéä Global Bitcoin Celebration</h3>
            <p>This is a historic milestone for Bitcoin! Join celebrations happening around the world, or host your own party in your city.</p>
            <p style="margin-top: 1rem; font-weight: 600;">
                üìç Flagship event in Monterrey, Mexico - Hosted by ArcadiaB & BitcoinSingularity.AI
            </p>
        </div>
    </div>

    <!-- Global Party Map Section -->
    <section class="map-section">
        <h2>üåç 20M Bitcoin Party Map</h2>
        <p style="text-align: center; color: var(--text-secondary); margin-bottom: 2rem;">
            Find a celebration near you or add your own!
        </p>

        <div id="party-map"></div>

        <div class="add-party-form">
            <h3>üéâ Host a 20M Bitcoin Party in Your City</h3>
            <form id="party-submission-form" name="bitcoin-party" method="POST" data-netlify="true" netlify-honeypot="bot-field" action="/btc-20m-countdown.html?success=true">
                <!-- Netlify Forms -->
                <input type="hidden" name="form-name" value="bitcoin-party" />
                <p style="display:none;">
                    <label>Don't fill this out if you're human: <input name="bot-field" /></label>
                </p>
                
                <div class="form-group">
                    <label for="city">City *</label>
                    <input type="text" id="city" name="city" required placeholder="e.g., Monterrey">
                </div>

                <div class="form-group">
                    <label for="country">Country *</label>
                    <input type="text" id="country" name="country" required placeholder="e.g., Mexico">
                </div>

                <div class="form-group">
                    <label for="venue">Venue Name (optional)</label>
                    <input type="text" id="venue" name="venue" placeholder="e.g., Bitcoin Caf√©">
                </div>

                <div class="form-group">
                    <label for="date">Date & Time *</label>
                    <input type="datetime-local" id="date" name="date" required>
                </div>

                <div class="form-group">
                    <label for="organizer">Organizer Name *</label>
                    <input type="text" id="organizer" name="organizer" required placeholder="Your name or organization">
                </div>

                <div class="form-group">
                    <label for="contact">Contact (Email, Nostr, or Website) *</label>
                    <input type="text" id="contact" name="contact" required placeholder="npub... or email@example.com">
                </div>

                <div class="form-group">
                    <label for="description">Description (optional)</label>
                    <textarea id="description" name="description" placeholder="Tell us about your celebration..."></textarea>
                </div>

                <button type="submit" class="submit-btn">Submit Party</button>
                
                <p class="form-note">
                    Submissions are manually approved to prevent spam. Your party will appear on the map within 24 hours.
                </p>
            </form>
        </div>

        <div class="parties-list" id="parties-list">
            <h3 style="text-align: center; color: var(--text-primary); margin-bottom: 1.5rem;">
                Registered Parties
            </h3>
            <!-- Party cards will be inserted here by JavaScript -->
        </div>
    </section>

    <script>
        // Constants
        const TARGET_SUPPLY = 20000000; // 20 million BTC
        const MAX_SUPPLY = 21000000;
        const BLOCK_TIME_SECONDS = 600; // ~10 minutes average
        const SATOSHIS_PER_BTC = 100000000;

        // Current block reward (changes at halving)
        const CURRENT_BLOCK_REWARD = 3.125; // BTC per block (post-2024 halving)

        let targetTimestamp = null;

        // Fetch current Bitcoin supply
        async function fetchBitcoinData() {
            try {
                // Get current supply in satoshis from blockchain.com
                const response = await fetch('https://blockchain.info/q/totalbc');
                const totalSatoshis = await response.text();
                const currentSupply = parseInt(totalSatoshis) / SATOSHIS_PER_BTC;

                updateDisplay(currentSupply);
            } catch (error) {
                console.error('Error fetching Bitcoin data:', error);
                // Fallback to estimate
                updateDisplay(19850000); // Approximate current supply
            }
        }

        function updateDisplay(currentSupply) {
            // Calculate remaining
            const remaining = TARGET_SUPPLY - currentSupply;
            const percentComplete = (currentSupply / TARGET_SUPPLY) * 100;

            // Calculate blocks remaining (approximately)
            const blocksRemaining = Math.ceil(remaining / CURRENT_BLOCK_REWARD);
            const secondsRemaining = blocksRemaining * BLOCK_TIME_SECONDS;
            targetTimestamp = Date.now() + (secondsRemaining * 1000);

            // Update stats
            document.getElementById('btc-mined').textContent = currentSupply.toLocaleString('en-US', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });

            document.getElementById('btc-remaining').textContent = remaining.toLocaleString('en-US', {
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            });

            document.getElementById('blocks-remaining').textContent = 
                `~${blocksRemaining.toLocaleString()} blocks remaining`;

            // Update progress bar
            document.getElementById('progress-bar').style.width = `${percentComplete}%`;
            document.getElementById('progress-percent').textContent = `${percentComplete.toFixed(2)}%`;

            // Update target date
            const targetDate = new Date(targetTimestamp);
            document.getElementById('target-date').textContent = targetDate.toLocaleDateString('en-US', {
                month: 'long',
                day: 'numeric',
                year: 'numeric'
            });
            document.getElementById('target-time').textContent = targetDate.toLocaleTimeString('en-US', {
                hour: '2-digit',
                minute: '2-digit',
                timeZoneName: 'short'
            });

            // Start countdown
            updateCountdown();
        }

        function updateCountdown() {
            if (!targetTimestamp) return;

            const now = Date.now();
            const diff = targetTimestamp - now;

            if (diff <= 0) {
                // Milestone reached!
                document.getElementById('days').textContent = '00';
                document.getElementById('hours').textContent = '00';
                document.getElementById('minutes').textContent = '00';
                document.getElementById('seconds').textContent = '00';
                return;
            }

            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);

            document.getElementById('days').textContent = String(days).padStart(2, '0');
            document.getElementById('hours').textContent = String(hours).padStart(2, '0');
            document.getElementById('minutes').textContent = String(minutes).padStart(2, '0');
            document.getElementById('seconds').textContent = String(seconds).padStart(2, '0');

            requestAnimationFrame(updateCountdown);
        }

        // Initialize
        fetchBitcoinData();

        // Refresh data every 10 minutes
        setInterval(fetchBitcoinData, 10 * 60 * 1000);
    </script>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- Party Map Script -->
    <script>
        // Initialize map centered on world
        const map = L.map('party-map').setView([20, 0], 2);

        // Add tile layer (map style)
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; OpenStreetMap contributors',
            maxZoom: 19
        }).addTo(map);

        // Bitcoin orange marker icon
        const bitcoinIcon = L.divIcon({
            className: 'custom-marker',
            html: '<div style="background: #F7931A; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 18px; border: 2px solid #fff;">‚Çø</div>',
            iconSize: [30, 30],
            iconAnchor: [15, 15]
        });

        // Party data (will be populated from database/form submissions)
        const parties = [
            // Parties will be added here from submissions
            // Example format:
            // {
            //     city: 'City Name',
            //     country: 'Country',
            //     lat: 25.6866,
            //     lng: -100.3161,
            //     venue: 'Venue Name',
            //     organizer: 'Organizer',
            //     date: 'March 12, 2026',
            //     contact: 'https://example.com or npub...',
            //     description: 'Description here',
            //     flagship: false
            // }
        ];

        // Add markers to map
        function renderParties() {
            parties.forEach(party => {
                const marker = L.marker([party.lat, party.lng], {
                    icon: bitcoinIcon
                }).addTo(map);

                // Popup content
                const popupContent = `
                    <div style="color: #0a0a0f; min-width: 200px;">
                        <h4 style="margin: 0 0 0.5rem 0; color: #F7931A;">
                            ${party.flagship ? '‚≠ê ' : ''}${party.city}, ${party.country}
                        </h4>
                        ${party.venue ? `<p style="margin: 0.25rem 0;"><strong>Venue:</strong> ${party.venue}</p>` : ''}
                        <p style="margin: 0.25rem 0;"><strong>Date:</strong> ${party.date}</p>
                        <p style="margin: 0.25rem 0;"><strong>Organizer:</strong> ${party.organizer}</p>
                        ${party.description ? `<p style="margin: 0.5rem 0 0 0; font-size: 0.9rem;">${party.description}</p>` : ''}
                        ${party.contact ? `<p style="margin: 0.5rem 0 0 0;"><a href="${party.contact}" target="_blank" style="color: #F7931A;">Contact/Info ‚Üí</a></p>` : ''}
                    </div>
                `;

                marker.bindPopup(popupContent);
            });

            // Also render party list
            renderPartyList();
        }

        // Render party list below map
        function renderPartyList() {
            const listContainer = document.getElementById('parties-list');
            
            if (parties.length === 0) {
                listContainer.innerHTML = `
                    <h3 style="text-align: center; color: var(--text-primary); margin-bottom: 1.5rem;">
                        Registered Parties (0)
                    </h3>
                    <div style="text-align: center; padding: 3rem; color: var(--text-secondary);">
                        <p style="font-size: 1.2rem; margin-bottom: 1rem;">üéâ Be the first to host a 20M Bitcoin party!</p>
                        <p>Fill out the form above to register your celebration.</p>
                    </div>
                `;
                return;
            }
            
            const partiesHTML = parties.map(party => `
                <div class="party-card">
                    <h4>${party.flagship ? '‚≠ê ' : ''}${party.city}, ${party.country}</h4>
                    ${party.venue ? `<p><strong>Venue:</strong> ${party.venue}</p>` : ''}
                    <p><strong>Date:</strong> ${party.date}</p>
                    <p><strong>Organizer:</strong> ${party.organizer}</p>
                    ${party.description ? `<p style="margin-top: 0.5rem;">${party.description}</p>` : ''}
                    ${party.contact ? `<p><a href="${party.contact}" target="_blank" style="color: var(--bitcoin-orange); text-decoration: none;">Contact/Info ‚Üí</a></p>` : ''}
                </div>
            `).join('');

            listContainer.innerHTML = `
                <h3 style="text-align: center; color: var(--text-primary); margin-bottom: 1.5rem;">
                    Registered Parties (${parties.length})
                </h3>
                ${partiesHTML}
            `;
        }

        // Show success message if form was submitted
        if (window.location.search.includes('success=true')) {
            alert('Thank you for submitting your party! üéâ\n\nYour submission has been sent to our team.\n\nYou will be added to the map within 24 hours after review.\n\nIn the meantime, share the countdown page with your community!');
            // Clean up URL
            window.history.replaceState({}, document.title, window.location.pathname);
        }

        // Initialize map
        renderParties();
    </script>
</body>
</html>
